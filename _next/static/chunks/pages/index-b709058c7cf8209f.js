(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{3215:function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))(function(i,l){function s(e){try{c(a.next(e))}catch(e){l(e)}}function r(e){try{c(a.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?i(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(s,r)}c((a=a.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.VisibilityEventInvoker=t.View=t.MessageType=t.TrackingEvent=t.Color=t.ModalStatus=t.Modal=t.Event=t.Command=void 0;let i=n(8202),l=n(765),s=Object.values(l.Command),r=Object.values(l.Event);var c=n(765);Object.defineProperty(t,"Command",{enumerable:!0,get:function(){return c.Command}}),Object.defineProperty(t,"Event",{enumerable:!0,get:function(){return c.Event}}),Object.defineProperty(t,"Modal",{enumerable:!0,get:function(){return c.Modal}}),Object.defineProperty(t,"ModalStatus",{enumerable:!0,get:function(){return c.ModalStatus}}),Object.defineProperty(t,"Color",{enumerable:!0,get:function(){return c.Color}}),Object.defineProperty(t,"TrackingEvent",{enumerable:!0,get:function(){return c.TrackingEvent}}),Object.defineProperty(t,"MessageType",{enumerable:!0,get:function(){return c.MessageType}}),Object.defineProperty(t,"View",{enumerable:!0,get:function(){return c.View}}),Object.defineProperty(t,"VisibilityEventInvoker",{enumerable:!0,get:function(){return c.VisibilityEventInvoker}}),t.default=class{constructor(e={}){let{identifier:t,targetWindow:n}=e;if(this.initialized=!1,this.window=null!=n?n:window.parent,this.identifier=null!=t?t:(0,i.detectIdentifier)(),!this.identifier)throw Error("Missing custom UI identifier");(0,i.detectIframeFocus)(()=>{this.track(l.TrackingEvent.FOCUSED)})}postMessage(e,t="*"){return new Promise((n,a)=>{let i=new MessageChannel,l={payload:e,id:this.identifier};i.port1.onmessage=({data:e})=>{i.port1.close();let{error:t,data:l}=e;t?a(Error(t)):n(l)},this.window.postMessage(l,t,[i.port2])})}execute(e,...t){if(!this.initialized)throw Error("SDK is not initialized");if(!s.includes(e))throw Error("Invalid command");return this.postMessage({command:e,args:t[0],type:l.MessageType.COMMAND})}track(e,t="*"){let n={payload:{type:l.MessageType.TRACK,event:e},id:this.identifier};this.window.postMessage(n,t)}listen(e,t){if(!r.includes(e))throw Error("Invalid event");let n=new MessageChannel,a={payload:{type:l.MessageType.LISTENER,event:e},id:this.identifier};return n.port1.onmessage=({data:e})=>{e.error&&n.port1.close(),t(e)},this.window.postMessage(a,"*",[n.port2]),()=>{n.port1.close()}}setWindow(e){this.window=e}initialize(e={}){return a(this,void 0,void 0,function*(){return yield this.postMessage({command:l.Command.INITIALIZE,args:e,type:l.MessageType.COMMAND}),this.initialized=!0,this})}}},765:function(e,t){"use strict";var n,a,i,l,s,r,c,o;Object.defineProperty(t,"__esModule",{value:!0}),t.View=t.VisibilityEventInvoker=t.TrackingEvent=t.ModalStatus=t.Modal=t.Color=t.MessageType=t.Event=t.Command=void 0,(n=t.Command||(t.Command={})).SHOW_SNACKBAR="show_snackbar",n.SHOW_CONFIRMATION="show_confirmation",n.RESIZE="resize",n.INITIALIZE="initialize",n.OPEN_MODAL="open_modal",n.CLOSE_MODAL="close_modal",n.GET_SIGNED_TOKEN="get_signed_token",n.REDIRECT_TO="redirect_to",n.SHOW_FLOATING_WINDOW="show_floating_window",n.HIDE_FLOATING_WINDOW="hide_floating_window",n.SET_NOTIFICATION="set_notification",n.SET_FOCUS_MODE="set_focus_mode",(a=t.Event||(t.Event={})).VISIBILITY="visibility",a.CLOSE_CUSTOM_MODAL="close_custom_modal",(i=t.MessageType||(t.MessageType={})).COMMAND="command",i.LISTENER="listener",i.TRACK="track",(l=t.Color||(t.Color={})).PRIMARY="primary",l.SECONDARY="secondary",l.NEGATIVE="negative",(s=t.Modal||(t.Modal={})).DEAL="deal",s.ORGANIZATION="organization",s.PERSON="person",s.ACTIVITY="activity",s.JSON_MODAL="json_modal",s.CUSTOM_MODAL="custom_modal",(r=t.ModalStatus||(t.ModalStatus={})).CLOSED="closed",r.SUBMITTED="submitted",(t.TrackingEvent||(t.TrackingEvent={})).FOCUSED="focused",(c=t.VisibilityEventInvoker||(t.VisibilityEventInvoker={})).USER="user",c.COMMAND="command",(o=t.View||(t.View={})).DEALS="deals",o.LEADS="leads",o.ORGANIZATIONS="organizations",o.CONTACTS="contacts",o.CAMPAIGNS="campaigns",o.PROJECTS="projects",o.SETTINGS="settings"},8202:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.detectIdentifier=t.detectIframeFocus=void 0,t.detectIframeFocus=function(e){let t=!1;null==window||window.addEventListener("focus",()=>{t||e(),t=!0}),null==window||window.addEventListener("blur",()=>{t=!1})},t.detectIdentifier=function(){let e=new URLSearchParams(window.location.search);return e.get("id")}},5557:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(9472)}])},9472:function(e,t,n){"use strict";let a;n.r(t),n.d(t,{__N_SSP:function(){return M},default:function(){return A}});var i=n(5893),l=n(1163),s=n(7294),r=n(6052),c=n(3583),o=n(5453),d=n(3215),u=n.n(d);let m=(0,o.Z)("Custom UI SDK"),h=async()=>{try{if(a)return a;return m.info("Initializing SDK"),a=await new(u())().initialize({size:{height:550}})}catch(e){m.error("Error during SDK initialization",e)}},p=async e=>{m.info("Opening activity modal"),await e.execute(d.Command.OPEN_MODAL,{type:d.Modal.ACTIVITY})},g=async(e,t)=>{m.info("Redirecting to ".concat(t)),await e.execute(d.Command.REDIRECT_TO,{view:d.View.CONTACTS,id:t})},b=(0,o.Z)("socket"),v=(e,t,n)=>{e&&(e.on("connect",()=>{b.info("Client connected.")}),e.on("OUTBOUND_CALL",function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];b.info("Receiving outgoing call...")}),e.on("INBOUND_CALL",function(){for(var e=arguments.length,n=Array(e),a=0;a<e;a++)n[a]=arguments[a];b.info("Receiving incoming call..."),"listening"===t.callerState?f(t,n[0].number):b.info("Cannot place a call when a current call is in progress")}))},f=(e,t)=>{e.setCallerState("ringing"),e.setCallerDetails({number:t,direction:"in",existing:!1})},j=(e,t)=>{e.setCallerState("ringing"),setTimeout(()=>{e.setCallerState("connected")},2e3),e.setCallerDetails({id:t,direction:"out",existing:!0})};var x=()=>(0,i.jsx)("div",{className:"alert alert-light text-center note",children:(0,i.jsx)("small",{children:"Since this is a demo app, no real calls will be placed.You can however, fake the interactions using the control centre"})}),N=e=>{let t=(0,l.useRouter)(),[n,a]=(0,s.useState)(""),[r,c]=(0,s.useState)([]);(0,s.useEffect)(()=>{fetch("/api/getContacts",{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(e=>{n&&(e=e.filter(e=>e.contactName.includes(n))),c(e)})},[t,n]);let o=e=>{a(e.target.value)};return(0,i.jsxs)("div",{className:"container-fluid",children:[(0,i.jsxs)("div",{className:"row",children:[(0,i.jsx)("nav",{className:"navbar navbar-light bg-mildgreen",children:(0,i.jsx)("div",{className:"container-fluid",children:(0,i.jsxs)("span",{className:"navbar-brand",children:[" \uD83D\uDFE2 Hello, ",e.user.name," "]})})}),(0,i.jsx)("p",{children:" Search and Tap on a contact name to dial "}),(0,i.jsxs)("div",{className:"input-group mb-3",children:[(0,i.jsx)("span",{className:"input-group-text",id:"basic-addon1",children:"\uD83D\uDD0D"}),(0,i.jsx)("input",{type:"text",className:"form-control",placeholder:"Type the name of the contact",onChange:e=>o(e)})]}),(0,i.jsx)("ol",{className:"contact-list list-group",children:r.map(t=>(0,i.jsx)("li",{onClick:()=>j(e,t.contactId),className:"list-group-item d-flex justify-content-between align-items-start",children:(0,i.jsx)("div",{children:(0,i.jsxs)("div",{className:"ms-2 me-auto",children:[(0,i.jsxs)("div",{className:"fw-bold",children:[" ",t.contactName," "]}),t.contactNumber]})})},t.contactId))})]}),(0,i.jsx)("div",{className:"fixed-bottom",children:(0,i.jsx)(x,{})})]})},w=e=>{let t=async()=>{e.setCallerState("listening")},n=async()=>{e.setCallerState("connected")},a=async()=>{let t=document.getElementById("notes").value,n=document.getElementById("contact_name").value,a=await fetch("/api/addContact",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({name:n,number:e.callerDetails.number,notes:t})}),i=await a.json(),l=i.data;e.setCallerDetails({...e.callerDetails,id:l.id}),e.setCallerState("disconnected")},l=async()=>{let t=document.getElementById("notes").value,n=document.getElementById("deals").value,a=new Date().toISOString().replace(/T/," ").replace(/\..+/,"");await fetch("/api/addCallLogsToDeal",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({dealId:n,note:t,to_phone_number:e.callerDetails.number,start_time:a,end_time:a,outcome:"busy"})}),e.setCallerState("disconnected")},s=async()=>{let t=document.getElementById("notes").value;await fetch("/api/addNotesToContact",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:e.callerDetails.id,notes:t})}),e.setCallerState("disconnected")};return(0,i.jsxs)(i.Fragment,{children:["in"===e.callerDetails.direction&&"ringing"===e.callerState&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{type:"button",onClick:n,className:"btn btn-success mt-2 w-100",children:"Answer"}),(0,i.jsx)("button",{type:"button",onClick:t,className:"btn btn-danger mt-2 w-100",children:"Reject"})]}),("connected"===e.callerState||"ringing"===e.callerState)&&(0,i.jsx)("button",{type:"button",className:"w-100 mt-2  btn btn-danger",onClick:t,children:"Hang Up"}),"connected"===e.callerState&&!e.callerDetails.existing&&(0,i.jsx)("button",{type:"button",className:"w-100 mt-2 btn btn-warning",onClick:a,children:"Hang Up and Create Contact"}),"connected"===e.callerState&&e.callerDetails.existing&&e.callerDetails.relatedDeals&&(0,i.jsx)("button",{type:"button",className:"w-100 mt-2 btn btn-warning",onClick:l,children:"Hang Up and add notes to deal."}),"connected"===e.callerState&&e.callerDetails.existing&&!e.callerDetails.relatedDeals&&(0,i.jsx)("button",{type:"button",className:"w-100 mt-2 btn btn-warning",onClick:s,children:"Hang Up and add notes to contact"})]})},C=e=>{var t;return e.existingContact?(null===(t=e.relatedDeals)||void 0===t?void 0:t.length)?(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:" Related Deal "}),(0,i.jsx)("select",{id:"deals",className:"form-select",children:e.relatedDeals.map(e=>(0,i.jsxs)("option",{value:e.id,children:[e.title," - ",e.value," ",e.currency]},e.id))})]}):(0,i.jsx)("div",{children:"No related deals found. Notes will be saved against the contact"}):(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:" Contact Name "}),(0,i.jsx)("input",{id:"contact_name",placeholder:"Enter a contact name for this number",className:"form-control"})]})},y=e=>{var t,n;return"ringing"===e.callerState?(0,i.jsx)("div",{className:"p-2",children:(0,i.jsxs)("div",{className:"position-absolute top-50 start-50 translate-middle text-center",children:[(0,i.jsx)("img",{src:(null===(t=e.callerDetails)||void 0===t?void 0:t.picture)||"/profile.png",alt:e.callerDetails.name,className:"mb-3 caller-image",width:"72",height:"72"}),(0,i.jsxs)("h1",{children:[" ",e.callerDetails.name," "]}),(0,i.jsxs)("span",{children:[" ",e.callerDetails.number," "]})]})}):"connected"===e.callerState?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("div",{className:"row p-2",children:[(0,i.jsx)("div",{className:"col-4",children:(0,i.jsx)("img",{src:(null===(n=e.callerDetails)||void 0===n?void 0:n.picture)||"/profile.png",className:"mb-3 caller-image",alt:e.callerDetails.name,width:"72",height:"72"})}),(0,i.jsx)("div",{className:"col-6 p-2",children:(0,i.jsxs)("div",{className:"position-relative mt-3",children:[(0,i.jsxs)("h1",{children:[" ",e.callerDetails.name," "]}),(0,i.jsxs)("span",{children:[" ",e.callerDetails.number," "]})]})})]}),(0,i.jsxs)("div",{className:"p-2",children:[(0,i.jsxs)("div",{className:"mb-3",children:[(0,i.jsx)("label",{className:"form-label",children:" Notes "}),(0,i.jsx)("textarea",{id:"notes",placeholder:"Add notes to the call here. This will be added to the call recording.",className:"form-control",rows:"3"})]}),(0,i.jsx)(C,{existingContact:e.callerDetails.existing,relatedDeals:e.callerDetails.relatedDeals})]})]}):void 0},D=e=>{let t="";return"connected"===e.callerState&&(t+="[Ongoing] "),"in"===e.callerDetails.direction?t+="Incoming Call":"out"===e.callerDetails.direction&&(t+="Outgiong Call"),"disconnected"===e.callerState&&(t+=" Over"),(0,i.jsx)("div",{className:"w-100 p-2 status-indicator",children:t})},E=e=>{let t=(e,t)=>{var n;e.setCallerDetails({...e.callerDetails,name:t.name,picture:(null==t?void 0:null===(n=t.picture_id)||void 0===n?void 0:n.pictures["128"])||"/profile.png",number:t.number,relatedDeals:null==t?void 0:t.relatedDeals,existing:t.existing,id:t.id})};return(0,s.useEffect)(()=>{fetch("/api/getContact?id=".concat(e.callerDetails.id,"&number=").concat(e.callerDetails.number),{headers:{Accept:"application/json","Content-Type":"application/json"}}).then(e=>e.json()).then(n=>{t(e,n)})},[]),(0,i.jsxs)("div",{className:"vh-100",children:[(0,i.jsx)("nav",{className:"navbar navbar-light bg-mildgreen",children:(0,i.jsx)("div",{className:"container-fluid",children:(0,i.jsxs)("span",{className:"navbar-brand",children:[" \uD83D\uDFE2 Hello, ",e.user.name," "]})})}),(0,i.jsx)(D,{...e}),(0,i.jsx)(y,{...e}),(0,i.jsxs)("div",{className:"fixed-bottom m-2",children:[(0,i.jsx)(w,{...e}),(0,i.jsx)(x,{})]})]})};let S=(0,o.Z)("FollowUp");var O=e=>{let t=async()=>{S.info("Invoking activity dialog...");let e=await h();p(e)},n=async()=>{S.info("Navigating to the contact based on the contact ID");let t=await h();g(t,e.callerDetails.id)},a=async()=>{S.info("Going back to the dialer by changing the state"),e.setCallerState("listening")};return e.callerDetails.existing?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{type:"button",className:"btn btn-link w-100",onClick:t,children:"Create a follow-up activity"}),(0,i.jsx)("button",{type:"button",className:"btn btn-link w-100",onClick:a,children:"Go to dialer"})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("button",{type:"button",className:"btn btn-link w-100",onClick:n,children:"View Contact"}),(0,i.jsx)("button",{type:"button",className:"btn btn-link w-100 m-1",onClick:a,children:"Go to dialer"})]})},T=e=>(0,i.jsxs)("div",{className:"vh-100",children:[(0,i.jsx)("nav",{className:"navbar navbar-light bg-mildgreen",children:(0,i.jsx)("div",{className:"container-fluid",children:(0,i.jsxs)("span",{className:"navbar-brand",children:[" \uD83D\uDFE2 Hello, ",e.user.name," "]})})}),(0,i.jsx)(D,{...e}),(0,i.jsx)("div",{className:"p-2",children:(0,i.jsx)("div",{className:"position-absolute top-50 start-50 translate-middle text-center",children:(0,i.jsx)("h6",{children:!1===e.callerDetails.existing?"✅ Contact Saved":"✅ Call Log Saved"})})}),(0,i.jsxs)("div",{className:"fixed-bottom m-2",children:[(0,i.jsx)(O,{...e}),(0,i.jsx)(x,{})]})]}),I=()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("a",{className:"p-2 m-2",target:"_blank",rel:"noreferrer",href:"http://localhost:3000/api/auth/login",children:"Please re-authorize"}),"and then",(0,i.jsx)("a",{href:"#",onClick:()=>{window.location.reload()},children:"refresh the page"})]});let _=(0,o.Z)("Core ✨");var M=!0,A=e=>{let{auth:t,session:n}=e,a=(0,l.useRouter)(),o=(0,c.b)(),d=(0,r.ZP)();if((0,s.useEffect)(()=>{t&&(_.info("Setting user ID to ",a.query.userId),o.setUser(n),(async()=>{let e=await h();await fetch("/api/socket",{headers:{Accept:"application/json","Content-Type":"application/json"}}),v(d,o,e)})())},[a]),!1===t)return(0,i.jsx)(I,{});switch(o.callerState){case"listening":default:return(0,i.jsx)(N,{...o});case"ringing":case"connected":return(0,i.jsx)(E,{...o});case"disconnected":return(0,i.jsx)(T,{...o})}}},1163:function(e,t,n){e.exports=n(8355)}},function(e){e.O(0,[52,774,888,179],function(){return e(e.s=5557)}),_N_E=e.O()}]);